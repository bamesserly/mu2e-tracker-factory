Connect the View/Edit Pallet button to the following function:

    def editPallet(self):
        rem = removeStraw()
        rem.palletDirectory = self.palletDirectory
        rem.sessionWorkers = self.sessionWorkers
        CPAL, lastTask, straws, passfail = rem.getPallet(self.palletNum)
        rem.displayPallet(CPAL, lastTask, straws, passfail)
        rem.exec_()

This button should be disabled whenever the CPALID is not known to the GUI.

Copy this class definition into the gui code:


class removeStraw(QDialog):
    def __init__(self, webapp=None, parent=None):
        super(removeStraw,self).__init__(parent) 
        self.ui = Ui_Dialogw()
        self.ui.setupUi(self)
        self.palletDirectory = ''
        self.sessionWorkers = []
        self.strawLabels = [self.ui.straw_1,self.ui.straw_2,self.ui.straw_3,self.ui.straw_4,
                            self.ui.straw_5,self.ui.straw_6,self.ui.straw_7,self.ui.straw_8,
                            self.ui.straw_9,self.ui.straw_10,self.ui.straw_11,self.ui.straw_12,
                            self.ui.straw_13,self.ui.straw_14,self.ui.straw_15,self.ui.straw_16,
                            self.ui.straw_17,self.ui.straw_18,self.ui.straw_19,self.ui.straw_20,
                            self.ui.straw_21,self.ui.straw_22,self.ui.straw_23,self.ui.straw_24]
        self.pfLabels = [self.ui.pf_1,self.ui.pf_2,self.ui.pf_3,self.ui.pf_4,
                         self.ui.pf_5,self.ui.pf_6,self.ui.pf_7,self.ui.pf_8,
                         self.ui.pf_9,self.ui.pf_10,self.ui.pf_11,self.ui.pf_12,
                         self.ui.pf_13,self.ui.pf_14,self.ui.pf_15,self.ui.pf_16,
                         self.ui.pf_17,self.ui.pf_18,self.ui.pf_19,self.ui.pf_20,
                         self.ui.pf_21,self.ui.pf_22,self.ui.pf_23,self.ui.pf_24]
        self.ui.removeButtons.buttonClicked.connect(self.delete)
        
    def getPallet(self, CPAL):
        lastTask = ''
        straws = []
        passfail = []
        for palletid in os.listdir(self.palletDirectory):
            for pallet in os.listdir(self.palletDirectory + palletid + '\\'):
                if CPAL + '.csv' == pallet:
                    with open(self.palletDirectory + palletid + '\\' + pallet, 'r') as file:
                        dummy = csv.reader(file)
                        history = []
                        for line in dummy:
                            if line != []:
                                history.append(line)
                        lastTask = history[len(history) - 1][1]
                        for entry in range(len(history[len(history ) - 1])):
                            if entry > 1 and entry < 50:
                                if entry%2 == 0:
                                    if history[len(history) - 1][entry] == '_______':
                                        straws.append('Empty')
                                    else:
                                        straws.append(history[len(history) - 1][entry])
                                else:
                                    if history[len(history) - 1][entry] == 'P':
                                        passfail.append('Pass')
                                    elif history[len(history) - 1][entry] == '_':
                                        passfail.append('Incomplete')
                                    else:
                                        passfail.append('Fail')
        return CPAL, lastTask, straws, passfail
    
    def displayPallet(self, CPAL, lastTask, straws, passfail):
        self.ui.palletLabel.setText('Pallet: ' + CPAL)
        steps1 = ['prep','ohms','C-O2','leak','lasr','leng','silv']
        steps2 = ['Straw Prep','Resistance','CO2 End Pieces','Leak Rate','Laser Cut','Length','Silver Epoxy']
        self.ui.lastLabel.setText('Last Step: ' + steps2[steps1.index(lastTask)])
        for pos in range(len(self.strawLabels)):
            self.strawLabels[pos].setText(straws[pos])
        for pos in range(len(self.pfLabels)):
            self.pfLabels[pos].setText(passfail[pos])

    def delete(self, btn):
        pos = int(btn.objectName().strip('remove_')) - 1
        CPAL, lastTask, straws, passfail = self.getPallet(self.ui.palletLabel.text()[8:])
        if straws[pos] == 'Empty':
            return
        buttonReply = QMessageBox.question(self, 'Straw Removal Confirmation', "Are you sure you want \
to permanently remove " + straws[pos] + " from " + CPAL + " ?", QMessageBox.Yes | QMessageBox.No, QMessageBox.No)
        if buttonReply != QMessageBox.Yes:
            return
        for palletid in os.listdir(self.palletDirectory):
            for pallet in os.listdir(self.palletDirectory + palletid + '\\'):
                if CPAL + '.csv' == pallet:
                    with open(self.palletDirectory + palletid + '\\' + pallet, 'a') as file:
                        file.write('\n')
                        file.write(datetime.now().strftime('%Y-%m-%d_%H:%M') + ',')
                        file.write(lastTask + ',')
                        for place in range(len(straws)):
                            if place == pos:
                                file.write('_______,_,')
                                continue
                            if straws[place] == 'Empty':
                                file.write('_______,_,')
                                continue
                            file.write(straws[place] + ',')
                            if passfail[place] == 'Pass':
                                file.write('P,')
                            elif passfail[place] == 'Incomplete':
                                file.write('_,')
                            else :
                                file.write('F,')
                        i = 0
                        for worker in self.sessionWorkers:
                            file.write(worker)
                            if i != len(self.sessionWorkers) - 1:
                                file.write(',')
                            i = i + 1
        CPAL, lastTask, straws, passfail = self.getPallet(CPAL)
        self.displayPallet(CPAL, lastTask, straws, passfail)